(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"005c":function(e,t,s){},"0c27":function(e,t,s){"use strict";s.d(t,"b",(function(){return i})),s.d(t,"c",(function(){return n})),s.d(t,"a",(function(){}));var i=function(){var e=this.$createElement;this._self._c},n=[]},"21f4":function(e,t,s){"use strict";var i=s("005c"),n=s.n(i);n.a},"327a":function(e,t,s){"use strict";(function(e,i){var n=s("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(s("e7c9")),u={data:function(){return{usey:1,usetab:0,fishinfo:[],usefish:{},usefishnmber:{end_tiem:1,satart_time:0,pick_code:"",syssn:"",name:"",nber:0},isfishnuber:!1,isfishend:!1,isshopfish:!0,isvip:!1,shopfish:"800202",tuik:!1,zdone:{is:!0,nber:0},zdtwo:{is:!0,nber:0},zdthreww:{is:!0,nber:0},zt:{is:!0,nber:0},useindex:0,isusetop:!1,usesetopdata:[]}},components:{Cart:function(){s.e("components/Cart").then(function(){return resolve(s("de37"))}.bind(null,s)).catch(s.oe)},iszore:function(){s.e("components/iszore").then(function(){return resolve(s("3def"))}.bind(null,s)).catch(s.oe)}},methods:{setisusetop:function(){if(0===this.usefishnmber.length)return e.showToast({title:"无订单",icon:"none",duration:1500});if(this.isusetop=!this.isusetop,console.log(this.usefish),this.isusetop)for(var t in this.usefish){var s="";s=this.useindex==t?"展示中":1e3*this.usefish[t].end_time-Date.now()>0?"可切换":"已结束",this.usesetopdata.push({name:"".concat(JSON.parse(this.usefish[this.useindex].detail).pool_name).concat(this.usefish[t].pick_code,"号"),endtime:this.gittiem(1e3*this.usefish[t].end_time),usezt:s})}else this.usesetopdata=[]},setuseindex:function(t,s){console.log(s),"已结束"!==s?(this.useindex=t,clearInterval(getApp().times),this.fishroot(),this.setisusetop(),e.showToast({title:"已切换",icon:"none",duration:1500})):e.showToast({title:"已结束,无法切换",icon:"none",duration:1500})},endprice:function(){return e.showToast({title:"请联系后台退款",icon:"none",duration:1500})},isvipbd:function(){var e=this;o.default.request({url:"https://bjcore01.vanshin.fun/fish/user/info",header:{sessionid:JSON.parse(i.getStorageSync("user")).sessionid}}).then((function(t){e.isvip=t.data.is_vip}))},gowallet:function(){i.navigateTo({url:"../wallet/wallet"})},addfishonetiem:function(){var e=this;i.showActionSheet({itemList:["微信支付","会员钱包支付"],success:function(t){1===t.tapIndex?(e.shopfish="700004",e.addfishtiem()):(e.shopfish="800202",e.addfishtiem())},fail:function(e){}})},addfishtiem:function(){var t=this;o.default.request({url:"https://bjcore01.vanshin.fun/fish/menu/list?menu_type=2",header:{sessionid:JSON.parse(i.getStorageSync("user")).sessionid}}).then((function(s){for(var n=t,u=s.data.list,a=[],h=0;h<u.length;h++)a.push("".concat(u[h].duration_desc,"(").concat(u[h].price_desc,")"));var r=t.usefishnmber.syssn;a=a.filter((function(e,t){return t<6})),i.showActionSheet({itemList:a,success:function(t){o.default.request({url:"https://bjcore01.vanshin.fun/fish/trade/append",header:{sessionid:JSON.parse(i.getStorageSync("user")).sessionid},method:"POST",data:{item_id:u[t.tapIndex].id,menu:JSON.stringify(u[t.tapIndex]),syssn:r,busicd:n.shopfish,openid:JSON.parse(i.getStorageSync("user")).openid}}).then((function(t){var s=t.data.syssn;"700004"==n.shopfish?"0000"==t.respcd?(e.showToast({title:"支付成功",icon:"none",duration:1500}),o.default.request({url:"https://bjcore01.vanshin.fun/fish/trade/query",method:"POST",header:{sessionid:JSON.parse(i.getStorageSync("user")).sessionid},data:{syssn:s}}).then((function(e){n.fishroot()}))):e.showToast({title:"账号余额不足",icon:"none",duration:1500}):i.requestPayment({timeStamp:t.data.timestamp,nonceStr:t.data.nonce_str,package:"prepay_id=".concat(t.data.prepay_id),signType:t.data.sign_type,paySign:t.data.pay_sign,success:function(e){"requestPayment:ok"==e.errMsg&&o.default.request({url:"https://bjcore01.vanshin.fun/fish/trade/query",method:"POST",header:{sessionid:JSON.parse(i.getStorageSync("user")).sessionid},data:{syssn:s}}).then((function(e){n.fishroot()}))},fail:function(t){e.showToast({title:"支付失败",icon:"none",duration:1500})}})}))},fail:function(e){}})}))},setTabid:function(e){this.usetab=e.target.current},sytab:function(){this.usetab=0},goshop:function(){this.usetab=1},getCode:function(){i.login({provider:"weixin",success:function(e){e.code}})},getfishinfo:function(){var e=this;o.default.request({url:"https://bjcore01.vanshin.fun/fish/menu/list?menu_type=1"}).then((function(t){console.log("数据",t.data.list),e.fishinfo=t.data.list}))},settime:function(){this.usefishnmber.nber=this.usefish.length;for(var e=0;e<this.usefish.length;e++){if(1e3*this.usefish[this.useindex].end_time>Date.now()){this.usetab=1,this.usefishnmber.syssn=this.usefish[this.useindex].syssn,this.usefishnmber.pick_code=this.usefish[this.useindex].pick_code;var t=this.usefish[0].end_time-this.usefish[this.useindex].start_time;return this.usefishnmber.satart_time=this.gittiem(1e3*t-288e5,!1),this.usefishnmber.end_tiem=this.gittiem(this.usefish[this.useindex].end_time-Date.now()-288e5),this.usefishnmber.name=JSON.parse(this.usefish[this.useindex].detail).pool_name,void(getApp().isshopfish=!1)}this.isfishnuber=!1}},gittiem:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=new Date(e),i=s.getHours(),n=s.getMinutes();return t?(i=i>9?i:"0"+i,n=n>9?n:"0"+n,"".concat(i,":").concat(n)):"".concat(i)},fishtiemset:function(){var t=this;if(0==this.usefish.length)return e.showToast({title:"暂无订单",icon:"none",duration:1500});getApp().times=setInterval((function(){if(0===t.usefish.length)return clearInterval(getApp().times);if(1e3*t.usefish[t.useindex].end_time-Date.now()>0){var s=1e3*t.usefish[t.useindex].end_time-Date.now()-288e5;if(t.usefishnmber.end_tiem=t.gittiem(s),t.isfishnuber=!0,s<-27e6){t.isfishend=!0,console.log("震动123");var n=s+288e5;t.zdone.is&&(t.zdone.nber=t.zdone.nber+1,i.vibrateLong(),4===t.zdone.nber&&(t.zdone.is=!1,e.showToast({title:"时间余额已不足",icon:"none",duration:2e3}))),t.zdtwo.is&&n<12e5&&(t.zdtwo.nber=t.zdtwo.nber+1,i.vibrateLong(),4===t.zdtwo.nber&&(t.zdtwo.is=!1,e.showToast({title:"时间余额已不足",icon:"none",duration:2e3}))),t.zdthreww.is&&n<3e5&&(console.log(n),t.zdthreww.nber=t.zdthreww.nber+1,i.vibrateLong(),4===t.zdthreww.nber&&(t.zdthreww.is=!1,i.showModal({title:"提示",content:"请在时长结束内15分钟返回后台退款回鱼，否则押金扣除",success:function(e){e.confirm&&console.log("用户点击确定")}})))}else t.zdone=t.zt,t.zdtwo=t.zt,t.zdthreww=t.zt}else t.isfishnuber=!1,Object.keys(t.usefishnmber).length,e.showToast({title:"暂无计时",icon:"none",duration:1e3}),clearInterval(getApp().times)}),1e3)},satefish:function(){this.usefish[this.useindex]&&(1e3*this.usefish[this.useindex].end_time-Date.now()>0?(this.settime(),this.fishtiemset()):this.isfishnuber=!1)},fishroot:function(){var e=this;i.getStorageSync("user")&&o.default.request({url:"https://bjcore01.vanshin.fun/fish/user/pledge_list",header:{sessionid:JSON.parse(i.getStorageSync("user")).sessionid}}).then((function(t){e.usefish=t.data,0!==e.usefish.length?e.satefish():e.isfishnuber=!1}))}},onLaunch:function(e){e&&(getApp().usetab=this.usetab)},mounted:function(){getApp().isshopfish=!0,this.fishroot(),this.isvipbd()},onShow:function(){getApp().fishusers&&(this.fishroot(),getApp().fishusers=!1),getApp().addfishtiem&&(this.addfishtiem(),getApp().addfishtiem=!1),this.usefish[this.useindex]&&(1e3*this.usefish[this.useindex].end_time-Date.now()>0?this.usetab=1:getApp().isshopfish),getApp().usetabflish&&(this.usetab=1,getApp().usetabflish=!1,this.fishroot()),1===getApp().usetab&&(this.usetab=getApp().usetab,this.fishroot(),getApp().usetab=0)},beforeMount:function(){this.getfishinfo()}};t.default=u}).call(this,s("543d")["default"],s("bc2e")["default"])},"4ff2":function(e,t,s){"use strict";(function(e,t){var i=s("4ea4");s("f47a");i(s("66fd"));var n=i(s("df57"));e.__webpack_require_UNI_MP_PLUGIN__=s,t(n.default)}).call(this,s("bc2e")["default"],s("543d")["createPage"])},"953f":function(e,t,s){"use strict";s.r(t);var i=s("327a"),n=s.n(i);for(var o in i)["default"].indexOf(o)<0&&function(e){s.d(t,e,(function(){return i[e]}))}(o);t["default"]=n.a},df57:function(e,t,s){"use strict";s.r(t);var i=s("0c27"),n=s("953f");for(var o in n)["default"].indexOf(o)<0&&function(e){s.d(t,e,(function(){return n[e]}))}(o);s("21f4");var u=s("f0c5"),a=Object(u["a"])(n["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=a.exports}},[["4ff2","common/runtime","common/vendor"]]]);